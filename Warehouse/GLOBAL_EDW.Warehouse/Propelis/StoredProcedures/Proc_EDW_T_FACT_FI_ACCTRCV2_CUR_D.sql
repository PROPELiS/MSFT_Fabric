CREATE     PROCEDURE [Propelis].[Proc_EDW_T_FACT_FI_ACCTRCV2_CUR_D]
AS
BEGIN
 
    -- Step 1: Clear existing data from the target table
    TRUNCATE TABLE [GLOBAL_EDW].[Propelis].[EDW_T_FACT_FI_ACCTRCV2_CUR_D];
	-- Step 2: Insert refreshed data from mirror table with joins

INSERT INTO [GLOBAL_EDW].[Propelis].[EDW_T_FACT_FI_ACCTRCV2_CUR_D]
(
		[CMPNY_KEY],
		[AR Document Header Number],
		[Baseline Due Fiscal Year],
		[AR Ledger Code],
		[AR Ledger Posting Item Number],
		[PAYER_CUST_KEY],
		[AR Document Line Item Number],
		[AR Clearing Document Number],
		[CLEARING_DATE_KEY],
		[AR Assignment Number],
		[AR Special GL Transaction Type],
		[AR Special GL Indicator],
		[DOCMT_DATE_KEY],
		[PSTNG_DATE_KEY],
		[DOCMT_CRNCY_KEY],
		[CMPNY_CRNCY_KEY],
		[GROUP_CRNCY_KEY],
		[AR Posting Period],
		[AR Document Type],
		[AR Reference Number],
		[AR Invoice Reference Number],
		[AR Reason Code],
		[AR Reason Code Description],
		[CMPNY_CRNCY_AMT],
		[DOCMT_CRNCY_AMT],
		[GROUP_CRNCY_AMT],
		[PSTNG_KEY],
		[DEBIT_CREDIT_IND],
		[GL_KEY],
		[BSLINE_DUE_DATE_KEY],
		[AR Payment Terms],
		[AR Days 1],
		[AR Days 2],
		[AR Days Net],
		[AR Reference Key for Line Item],
		[PROFT_CNTR_KEY],
		[SEG_KEY],
		[BILLING_DOCMT_KEY],
		[ETL_SRC_SYS_CD],
		[ETL_CREATED_TS],
		[ETL_UPDTD_TS],
		[AR Controlling Area],
		[WBS_ELEMNT_KEY],
		[SALES_AREA_KEY],
		[CUST_SALES_AREA_KEY],
		[CUST_CREDIT_KEY],
		[AR Document Type Description],
		[AR Special GL Indicator Description],
		[AR Posting Key Description],
		[AR Payment Terms Description],
		[AR Controlling Area Description],
		[AR Ledger Code Description],
		[AR Item Text],
		[AR Deletion Flag],
		[AR Debit Credit Indicator],
		[AR Expected Customer Sales Organization],
		[AR Expected Customer Sales Organization Description],
		[AR Expected Sales Organization],
		[AR Expected Sales Organization Description],
		[AR Dunning Block],
		[AR Dunning Block Description],
		[LAST_DUNNING_NOTICE_DATE_KEY],
		[AR Dunning Level],
		[DUNNING_KEY],
		[AR Dunning Key Description],

	--Below columns are added for the Alias tables
        [PROFCHZ_PROFT_CNTR_KEY],
        [PROFCVZ_PROFT_CNTR_KEY]
)	
SELECT 
		FACT.[CMPNY_KEY],
		FACT.[DOCMT_HDR_NUM],
		FACT.[FISCAL_YR],
		FACT.[LDGR_CD],
		FACT.[LDGR_PSTNG_ITM_NUM],
		FACT.[PAYER_CUST_KEY],
		FACT.[DOCMT_LINE_ITM_NUM],
		FACT.[CLEARING_DOCMT_NUM],
		FACT.[CLEARING_DATE_KEY],
		FACT.[ASSIGN_NUM],
		FACT.[SPCL_GL_TRNSCTN_TYP],
		FACT.[SPCL_GL_IND],
		FACT.[DOCMT_DATE_KEY],
		FACT.[PSTNG_DATE_KEY],
		FACT.[DOCMT_CRNCY_KEY],
		FACT.[CMPNY_CRNCY_KEY],
		FACT.[GROUP_CRNCY_KEY],
		FACT.[PSTNG_PER],
		FACT.[DOCMT_TYP],
		FACT.[REF_NUM],
		FACT.[INVC_REF_NUM],
		FACT.[RSN_CD],
		FACT.[RSN_CD_DESC],
		FACT.[CMPNY_CRNCY_AMT],
		FACT.[DOCMT_CRNCY_AMT],
		FACT.[GROUP_CRNCY_AMT],
		FACT.[PSTNG_KEY],
		FACT.[DEBIT_CREDIT_IND],
		FACT.[GL_KEY],
		FACT.[BSLINE_DUE_DATE_KEY],
		FACT.[PYMT_TRMS],
		FACT.[CASH_DISCOUNTS_DAY_1],
		FACT.[CASH_DISCOUNTS_DAY_2],
		FACT.[NET_PAYMENTS_TERM_PER],
		FACT.[REF_KEY_FOR_LINE_ITM],
		FACT.[PROFT_CNTR_KEY],
		FACT.[SEG_KEY],
		FACT.[BILLING_DOCMT_KEY],
		FACT.[ETL_SRC_SYS_CD],
		FACT.[ETL_CREATED_TS],
		FACT.[ETL_UPDTD_TS],
		FACT.[CONTROLLING_AREA],
		FACT.[WBS_ELEMNT_KEY],
		FACT.[SALES_AREA_KEY],
		FACT.[CUST_SALES_AREA_KEY],
		FACT.[CUST_CREDIT_KEY],
		FACT.[DOCMT_TYP_DESC],
		FACT.[SPCL_GL_IND_DESC],
		FACT.[PSTNG_KEY_DESC],
		FACT.[PYMT_TRMS_DESC],
		FACT.[CONTROLLING_AREA_DESC],
		FACT.[LDGR_CD_DESC],
		FACT.[ITM_TEXT],
		FACT.[DELETION_FLG],
		FACT.[DEBIT_CREDIT_IND_BSEG],
		FACT.[EXPECTED_CUST_SALES_ORGZTN],
		FACT.[EXPECTED_CUST_SALES_ORGZTN_DESC],
		FACT.[EXPECTED_SALES_ORGZTN],
		FACT.[EXPECTED_SALES_ORGZTN_DESC],
		FACT.[DUNNING_BLK],
		FACT.[DUNNING_BLK_DESC],
		FACT.[LAST_DUNNING_NOTICE_DATE_KEY],
		FACT.[DUNNING_LVL],
		FACT.[DUNNING_KEY],
		FACT.[DUNNING_KEY_DESC],

--Below columns are added for the Alias tables
        MST_PROFCTR.PROFT_CNTR_KEY AS PROFCHZ_PROFT_CNTR_KEY,
	    MST_PROFCTR.PROFT_CNTR_KEY AS PROFCVZ_PROFT_CNTR_KEY

			
FROM [GLOBAL_EDW_QA].[GLOBAL_EDW].[EDW_T_F_FI_ACCTRCV2_CUR_D] AS FACT

LEFT JOIN [GLOBAL_EDW].[Propelis].[POSTING_DATE] AS PS_DT
  ON FACT.PSTNG_DATE_KEY = PS_DT.DATE_KEY 
  
LEFT JOIN [GLOBAL_EDW].[Propelis].[DOCUMENT_DATE] AS DOCM_DT
  ON FACT.DOCMT_DATE_KEY = DOCM_DT.DATE_KEY
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_CMPNYCD_CUR_D] AS MST_CMPNYCD
  ON FACT.CMPNY_KEY = MST_CMPNYCD.CMPNY_KEY
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_CUSTOMR_CUR_D] AS MST_CUSTOMR
  ON FACT.PAYER_CUST_KEY = MST_CUSTOMR.CUST_KEY
  
LEFT JOIN [GLOBAL_EDW].[Propelis].[DOCUMENT_CURRENCY] AS DOCM_CRNCY
  ON FACT.DOCMT_CRNCY_KEY = DOCM_CRNCY.CRNCY_KEY
  
LEFT JOIN [GLOBAL_EDW].[Propelis].[GROUP_CURRENCY] AS GRP_CRNCY
   ON FACT.GROUP_CRNCY_KEY = GRP_CRNCY.CRNCY_KEY
   
LEFT JOIN [GLOBAL_EDW].[Propelis].[COMPANY_CURRENCY] AS CMPNY_CRNCY
  ON FACT.CMPNY_CRNCY_KEY = CMPNY_CRNCY.CRNCY_KEY
  
LEFT JOIN [GLOBAL_EDW].[Propelis].[CLEARING_DATE] AS CLR_DT
  ON FACT.CLEARING_DATE_KEY = CLR_DT.DATE_KEY
  
LEFT JOIN [GLOBAL_EDW].[Propelis].[BASELINE_DUE_DATE] AS BSL_D_DT
  ON FACT.BSLINE_DUE_DATE_KEY = BSL_D_DT.DATE_KEY
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_PROFCTR_CUR_D] AS MST_PROFCTR
  ON FACT.PROFT_CNTR_KEY = MST_PROFCTR.PROFT_CNTR_KEY
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_SAL_INVOICE_CUR_D] AS SAL_INVOICE
  ON FACT.BILLING_DOCMT_KEY = SAL_INVOICE.INVC_KEY

LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_PRS_WBSELEM_CUR_D] AS PRS_WBSELEM
  ON FACT.WBS_ELEMNT_KEY = PRS_WBSELEM.WBS_ELEMNT_KEY
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_GENLDGR_CUR_D] AS MST_GENLDGR
  ON FACT.GL_KEY = MST_GENLDGR.GL_KEY
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_CUSCRED_CUR_D] AS MST_CUSCRED
   ON FACT.CUST_CREDIT_KEY = MST_CUSCRED.CUST_CREDIT_KEY
   
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_SAL_SALAREA_CUR_D] AS SAL_SALAREA
   ON FACT.SALES_AREA_KEY= SAL_SALAREA.SALES_AREA_KEY   
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_CUSTSAL_CUR_D] AS MST_CUSTSAL
   ON FACT.CUST_SALES_AREA_KEY = MST_CUSTSAL.CUST_SALES_AREA_KEY
  
LEFT JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_SEGMEN2_CUR_D] AS MST_SEGMEN2
   ON FACT.SEG_KEY = MST_SEGMEN2.SEG_KEY
   
LEFT JOIN [GLOBAL_EDW].[Propelis].[LAST_DUNNING_NOTICE_DATE] AS LST_DN_DT
   ON FACT.LAST_DUNNING_NOTICE_DATE_KEY = LST_DN_DT.DATE_KEY;
   
END