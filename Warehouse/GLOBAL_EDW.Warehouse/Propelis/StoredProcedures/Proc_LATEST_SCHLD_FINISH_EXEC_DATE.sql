CREATE       PROCEDURE [Propelis].[Proc_LATEST_SCHLD_FINISH_EXEC_DATE] 
AS
BEGIN  
    ----------------------------------------------------------------------
    -- Update existing records
    ----------------------------------------------------------------------
    UPDATE T
    SET
        T.[DATE_KEY]                                                         = S.[DATE_KEY]                   ,
        T.[Latest Schld Finish Exec Date]                                   = S.[THE_DATE]                   ,
        T.[Latest Schld Finish Exec Fiscal Year]                            = S.[FISCAL_YR]                  ,
        T.[Latest Schld Finish Exec Fiscal Period Number]                   = S.[FISCAL_PER_NUM]             ,
        T.[Latest Schld Finish Exec Fiscal Period Code]                     = S.[FISCAL_PER_CD]              ,
        T.[Latest Schld Finish Exec Fiscal Quarter Number]                  = S.[FISCAL_QTR_NUM]             ,
        T.[Latest Schld Finish Exec Fiscal Quarter Code]                    = S.[FISCAL_QTR_CD]              ,
        T.[Latest Schld Finish Exec Calendar Year]                          = S.[CLNDR_YR]                   ,
        T.[Latest Schld Finish Exec Calendar Month Number]                  = S.[CLNDR_MNTH_NUM]             ,
        T.[Latest Schld Finish Exec Calendar Month Code]                    = S.[CLNDR_MNTH_CD]              ,
        T.[Latest Schld Finish Exec Calendar Month Description]             = S.[CLNDR_MNTH_DESC]            ,
        T.[Latest Schld Finish Exec Calendar Quarter Number]                = S.[CLNDR_QTR_NUM]              ,
        T.[Latest Schld Finish Exec Calendar Quarter Code]                  = S.[CLNDR_QTR_CD]               ,
        T.[Latest Schld Finish Exec Calendar Weekday Number]                = S.[CLNDR_WEEKDAY_NUM]          ,
        T.[Latest Schld Finish Exec Calendar Weekday Name]                  = S.[CLNDR_WEEKDAY_NAME]         ,
        T.[Latest Schld Finish Exec Calendar Day In Month]                  = S.[CLNDR_DAY_IN_MNTH]          ,
        T.[Latest Schld Finish Exec Calendar Day In Year]                   = S.[CLNDR_DAY_IN_YR]            ,
        T.[Latest Schld Finish Exec Calendar Week]                          = S.[CLNDR_WK]                   ,
        T.[Latest Schld Finish Exec Calendar Month In Quarter Number]       = S.[CLNDR_MNTH_IN_QTR_NUM]      ,
        T.[Latest Schld Finish Exec Calendar Days In Month]                 = S.[CLNDR_DAYS_IN_MNTH]         ,
        T.[ETL_SRC_SYS_CD]                                                   = S.[ETL_SRC_SYS_CD]             ,
        T.[ETL_CREATED_TS]                                                   = S.[ETL_CREATED_TS]             ,
        T.[ETL_UPDTD_TS]                                                     = S.[ETL_UPDTD_TS]               ,
        T.[Latest Schld Finish Exec Current Day Flag]                       = S.[CURR_DAY_FLG]               ,
        T.[Latest Schld Finish Exec Current Day Minus 1 Flag]               = S.[CURR_DAY_MINUS_1_FLG]       ,
        T.[Latest Schld Finish Exec Current Calendar Week Flag]             = S.[CURR_CLNDR_WK_FLG]          ,
        T.[Latest Schld Finish Exec Current Calendar Week Minus 1 Flag]     = S.[CURR_CLNDR_WK_MINUS_1_FLG]  ,
        T.[Latest Schld Finish Exec Current Month Flag]                     = S.[CURR_MNTH_FLG]              ,
        T.[Latest Schld Finish Exec Current Month Minus 1 Flag]             = S.[CURR_MNTH_MINUS_1_FLG]      ,
        T.[Latest Schld Finish Exec Current Month Minus 12 Flag]            = S.[CURR_MNTH_MINUS_12_FLG]     ,
        T.[Latest Schld Finish Exec Current Quarter Flag]                   = S.[CURR_QTR_FLG]               ,
        T.[Latest Schld Finish Exec Current Quarter Minus 1 Flag]           = S.[CURR_QTR_MINUS_1_FLG]       ,
        T.[Latest Schld Finish Exec Current Quarter Minus 4 Flag]           = S.[CURR_QTR_MINUS_4_FLG]       ,
        T.[Latest Schld Finish Exec Current Calendar Year Flag]             = S.[CURR_CLNDR_YR_FLG]          ,
        T.[Latest Schld Finish Exec Current Calendar Year Minus 1 Flag]     = S.[CURR_CLNDR_YR_MINUS_1_FLG]  ,
        T.[Latest Schld Finish Exec Current Calendar Year Minus 2 Flag]     = S.[CURR_CLNDR_YR_MINUS_2_FLG]  ,
        T.[Latest Schld Finish Exec Current Fiscal Year Flag]               = S.[CURR_FISCAL_YR_FLG]         ,
        T.[Latest Schld Finish Exec Current Fiscal Year Minus 1 Flag]       = S.[CURR_FISCAL_YR_MINUS_1_FLG] ,
        T.[Latest Schld Finish Exec Current Fiscal Year Minus 2 Flag]       = S.[CURR_FISCAL_YR_MINUS_2_FLG] ,
        T.[Latest Schld Finish Exec Current Calendar Year Plus 1 Flag]      = S.[CURR_CLNDR_YR_PLUS_1_FLG]   ,
        T.[Latest Schld Finish Exec Current Calendar Year Plus 2 Flag]      = S.[CURR_FISCAL_YR_PLUS_1_FLG]  ,
        T.[Latest Schld Finish Exec Day In Fiscal Year]                     = S.[DAY_IN_FISCAL_YR]           ,
        T.[Latest Schld Finish Exec Date Is Weekday]                        = S.[IS_WEEKDAY]                 ,
        T.[Latest Schld Finish Exec Fiscal Week]                            = S.[FISCAL_WK]                  ,
        T.[Latest Schld Finish Exec Current Fiscal Week Flag]               = S.[CURR_FISCAL_WK_FLG]         ,
        T.[Latest Schld Finish Exec Current Fiscal Week Minus 1 Flag]       = S.[CURR_FISCAL_WK_MINUS_1_FLG] ,
        T.[Latest Schld Finish Exec Fiscal Weekday Number]                  = S.[FISCAL_WEEKDAY_NUM]         ,
        T.[Latest Schld Finish Exec Fiscal Weekday Name]                    = S.[FISCAL_WEEKDAY_NAME]        ,
        T.[Latest Schld Finish Exec Current Month Minus 2 Flag]             = S.[CURR_MNTH_MINUS_2_FLG]      ,
        T.[Latest Schld Finish Exec Current Fiscal Week Minus 2 Flag]       = S.[CURR_FISCAL_WK_MINUS_2_FLG] ,
        T.[Latest Schld Finish Exec Current Fiscal Week Minus 6 Flag]       = S.[CURR_FISCAL_WK_MINUS_6_FLG] ,
        T.[Latest Schld Finish Exec Current Fiscal Week Minus 3 Flag]       = S.[CURR_FISCAL_WK_MINUS_3_FLG] ,
        T.[Latest Schld Finish Exec Current Fiscal Week Minus 4 Flag]       = S.[CURR_FISCAL_WK_MINUS_4_FLG] ,
        T.[Latest Schld Finish Exec Current Fiscal Week Minus 5 Flag]       = S.[CURR_FISCAL_WK_MINUS_5_FLG] ,
        T.[Latest Schld Finish Exec Current Fiscal Week Minus 7 Flag]       = S.[CURR_FISCAL_WK_MINUS_7_FLG]
    FROM [GLOBAL_EDW].[Propelis].[LATEST_SCHLD_FINISH_EXEC_DATE] T
    INNER JOIN [GLOBAL_EDW_MIRROR].[dbo].[EDW_T_D_MST_DATE_CUR_D] S
        ON T.[DATE_KEY] = S.[DATE_KEY];
 
    ----------------------------------------------------------------------
    -- Insert new records
    ----------------------------------------------------------------------
    INSERT INTO [GLOBAL_EDW].[Propelis].[LATEST_SCHLD_FINISH_EXEC_DATE] (
        [DATE_KEY]                                           ,
        [Latest Schld Finish Exec Date]                                  ,
        [Latest Schld Finish Exec Fiscal Year]                           ,
        [Latest Schld Finish Exec Fiscal Period Number]                  ,
        [Latest Schld Finish Exec Fiscal Period Code]                    ,
        [Latest Schld Finish Exec Fiscal Quarter Number]                 ,
        [Latest Schld Finish Exec Fiscal Quarter Code]                   ,
        [Latest Schld Finish Exec Calendar Year]                         ,
        [Latest Schld Finish Exec Calendar Month Number]                 ,
        [Latest Schld Finish Exec Calendar Month Code]                   ,
        [Latest Schld Finish Exec Calendar Month Description]            ,
        [Latest Schld Finish Exec Calendar Quarter Number]               ,
        [Latest Schld Finish Exec Calendar Quarter Code]                 ,
        [Latest Schld Finish Exec Calendar Weekday Number]               ,
        [Latest Schld Finish Exec Calendar Weekday Name]                 ,
        [Latest Schld Finish Exec Calendar Day In Month]                 ,
        [Latest Schld Finish Exec Calendar Day In Year]                  ,
        [Latest Schld Finish Exec Calendar Week]                         ,
        [Latest Schld Finish Exec Calendar Month In Quarter Number]      ,
        [Latest Schld Finish Exec Calendar Days In Month]                ,
        [ETL_SRC_SYS_CD]                                     ,
        [ETL_CREATED_TS]                                     ,
        [ETL_UPDTD_TS]                                       ,
        [Latest Schld Finish Exec Current Day Flag]                      ,
        [Latest Schld Finish Exec Current Day Minus 1 Flag]              ,
        [Latest Schld Finish Exec Current Calendar Week Flag]            ,
        [Latest Schld Finish Exec Current Calendar Week Minus 1 Flag]    ,
        [Latest Schld Finish Exec Current Month Flag]                    ,
        [Latest Schld Finish Exec Current Month Minus 1 Flag]            ,
        [Latest Schld Finish Exec Current Month Minus 12 Flag]           ,
        [Latest Schld Finish Exec Current Quarter Flag]                  ,
        [Latest Schld Finish Exec Current Quarter Minus 1 Flag]          ,
        [Latest Schld Finish Exec Current Quarter Minus 4 Flag]          ,
        [Latest Schld Finish Exec Current Calendar Year Flag]            ,
        [Latest Schld Finish Exec Current Calendar Year Minus 1 Flag]    ,
        [Latest Schld Finish Exec Current Calendar Year Minus 2 Flag]    ,
        [Latest Schld Finish Exec Current Fiscal Year Flag]              ,
        [Latest Schld Finish Exec Current Fiscal Year Minus 1 Flag]      ,
        [Latest Schld Finish Exec Current Fiscal Year Minus 2 Flag]      ,
        [Latest Schld Finish Exec Current Calendar Year Plus 1 Flag]     ,
        [Latest Schld Finish Exec Current Calendar Year Plus 2 Flag]     ,
        [Latest Schld Finish Exec Day In Fiscal Year]                    ,
        [Latest Schld Finish Exec Date Is Weekday]                       ,
        [Latest Schld Finish Exec Fiscal Week]                           ,
        [Latest Schld Finish Exec Current Fiscal Week Flag]              ,
        [Latest Schld Finish Exec Current Fiscal Week Minus 1 Flag]      ,
        [Latest Schld Finish Exec Fiscal Weekday Number]                 ,
        [Latest Schld Finish Exec Fiscal Weekday Name]                   ,
        [Latest Schld Finish Exec Current Month Minus 2 Flag]            ,
        [Latest Schld Finish Exec Current Fiscal Week Minus 2 Flag]      ,
        [Latest Schld Finish Exec Current Fiscal Week Minus 6 Flag]      ,
        [Latest Schld Finish Exec Current Fiscal Week Minus 3 Flag]      ,
        [Latest Schld Finish Exec Current Fiscal Week Minus 4 Flag]      ,
        [Latest Schld Finish Exec Current Fiscal Week Minus 5 Flag]      ,
        [Latest Schld Finish Exec Current Fiscal Week Minus 7 Flag]
    )
    SELECT
        S.[DATE_KEY]                        ,
        S.[THE_DATE]                        ,
        S.[FISCAL_YR]                       ,
        S.[FISCAL_PER_NUM]                  ,
        S.[FISCAL_PER_CD]                   ,
        S.[FISCAL_QTR_NUM]                  ,
        S.[FISCAL_QTR_CD]                   ,
        S.[CLNDR_YR]                        ,
        S.[CLNDR_MNTH_NUM]                  ,
        S.[CLNDR_MNTH_CD]                   ,
        S.[CLNDR_MNTH_DESC]                 ,
        S.[CLNDR_QTR_NUM]                   ,
        S.[CLNDR_QTR_CD]                    ,
        S.[CLNDR_WEEKDAY_NUM]               ,
        S.[CLNDR_WEEKDAY_NAME]              ,
        S.[CLNDR_DAY_IN_MNTH]               ,
        S.[CLNDR_DAY_IN_YR]                 ,
        S.[CLNDR_WK]                        ,
        S.[CLNDR_MNTH_IN_QTR_NUM]           ,
        S.[CLNDR_DAYS_IN_MNTH]              ,
        S.[ETL_SRC_SYS_CD]                  ,
        S.[ETL_CREATED_TS]                  ,
        S.[ETL_UPDTD_TS]                    ,
        S.[CURR_DAY_FLG]                    ,
        S.[CURR_DAY_MINUS_1_FLG]            ,
        S.[CURR_CLNDR_WK_FLG]               ,
        S.[CURR_CLNDR_WK_MINUS_1_FLG]       ,
        S.[CURR_MNTH_FLG]                   ,
        S.[CURR_MNTH_MINUS_1_FLG]           ,
        S.[CURR_MNTH_MINUS_12_FLG]          ,
        S.[CURR_QTR_FLG]                    ,
        S.[CURR_QTR_MINUS_1_FLG]            ,
        S.[CURR_QTR_MINUS_4_FLG]            ,
        S.[CURR_CLNDR_YR_FLG]               ,
        S.[CURR_CLNDR_YR_MINUS_1_FLG]       ,
        S.[CURR_CLNDR_YR_MINUS_2_FLG]       ,
        S.[CURR_FISCAL_YR_FLG]              ,
        S.[CURR_FISCAL_YR_MINUS_1_FLG]      ,
        S.[CURR_FISCAL_YR_MINUS_2_FLG]      ,
        S.[CURR_CLNDR_YR_PLUS_1_FLG]        ,
        S.[CURR_FISCAL_YR_PLUS_1_FLG]       ,
        S.[DAY_IN_FISCAL_YR]                ,
        S.[IS_WEEKDAY]                      ,
        S.[FISCAL_WK]                       ,
        S.[CURR_FISCAL_WK_FLG]              ,
        S.[CURR_FISCAL_WK_MINUS_1_FLG]      ,
        S.[FISCAL_WEEKDAY_NUM]              ,
        S.[FISCAL_WEEKDAY_NAME]             ,
        S.[CURR_MNTH_MINUS_2_FLG]           ,
        S.[CURR_FISCAL_WK_MINUS_2_FLG]      ,
        S.[CURR_FISCAL_WK_MINUS_6_FLG]      ,
        S.[CURR_FISCAL_WK_MINUS_3_FLG]      ,
        S.[CURR_FISCAL_WK_MINUS_4_FLG]      ,
        S.[CURR_FISCAL_WK_MINUS_5_FLG]      ,
        S.[CURR_FISCAL_WK_MINUS_7_FLG]
    FROM [GLOBAL_EDW_MIRROR].[dbo].[EDW_T_D_MST_DATE_CUR_D] S
    LEFT JOIN [GLOBAL_EDW].[Propelis].[LATEST_SCHLD_FINISH_EXEC_DATE] T
        ON T.[DATE_KEY] = S.[DATE_KEY]
    WHERE T.[DATE_KEY] IS NULL;
 
END