CREATE   PROCEDURE [Propelis].[Proc_OPERATION_LEVEL_WORK_CENTER]
AS
BEGIN
    -- Step 1: Update existing records in target from source
    UPDATE T
    SET
        [Operation Work Center ID] = S.[WRK_CNTR_ID],
        [Operation Work Center Plant ID] = S.[PLNT_ID],
        [Operation Work Center Object ID] = S.[OBJ_ID],
        [Operation Work Center Object Type] = S.[OBJ_TYP],
        [Operation Work Center Category] = S.[WRK_CNTR_CTGRY],
        [Operation Work Center Location] = S.[WRK_CNTR_LOC],
        [Operation Work Center Person Responsible] = S.[PERSON_RESPNSBLE],
        [Operation Work Center Standard Value Key] = S.[STD_VAL_KEY],
        [Operation Work Center Usage Code] = S.[USAGE_CD],
        [Operation Work Center Capacity ID] = S.[CAPACITY_ID],
        [Operation Work Center Supply Area] = S.[SUPLY_AREA],
        [Operation Work Center Deletion Flag] = S.[DELETION_FLG],
        [Operation Work Center Locked Status] = S.[LOCKED_STATUS],
        [ETL_SRC_SYS_CD] = S.[ETL_SRC_SYS_CD],
        [ETL_EFFECTV_BEGIN_DATE] = S.[ETL_EFFECTV_BEGIN_DATE],
        [ETL_EFFECTV_END_DATE] = S.[ETL_EFFECTV_END_DATE],
        [ETL_CURR_RCD_IND] = S.[ETL_CURR_RCD_IND],
        [ETL_CREATED_TS] = S.[ETL_CREATED_TS],
        [ETL_UPDTD_TS] = S.[ETL_UPDTD_TS],
        [Operation Work Center Description] = S.[WRK_CNTR_DESC],
        [Operation Work Center Category Description] = S.[WRK_CNTR_CTGRY_DESC],
        [Operation Work Center Person Responsible Name] = S.[PERSON_RESPNSBLE_NAME],
        [Operation Work Center Control Key] = S.[CTRL_KEY],
        [Operation Work Center Storage Location Storage Resource] = S.[STOR_LOC_STOR_RESOURCE],
        [Operation Work Center User Name Term] = S.[USR_NAME_TERM],
        [Operation Work Center User Name GRND] = S.[USR_NAME_GRND],
        [Operation Work Center Changed On Date Term] = S.[CHANGED_ON_DATE_TERM],
        [Operation Work Center Changed On Date GRND] = S.[CHANGED_ON_DATE_GRND],
        [Operation Work Center Changed On Date] = S.[CHANGED_ON_DATE],
        [Operation Work Center Plant Description] = S.[PLNT_DESC],
        [Operation Work Center Object Type Description] = S.[OBJ_TYP_DESC],
        [Operation Work Center Location Description] = S.[WRK_CNTR_LOC_DESC],
        [Operation Work Center Standard Value Description] = S.[STD_VAL_DESC],
        [Operation Work Center Usage Description] = S.[USAGE_DESC],
        [Operation Work Center Supply Area Description] = S.[SUPLY_AREA_DESC],
        [Operation Work Center Control Description] = S.[CTRL_DESC],
        [Operation Work Center Storage Location Description] = S.[STOR_LOC_DESC]
    FROM [GLOBAL_EDW].[Propelis].[OPERATION_LEVEL_WORK_CENTER] AS T
    INNER JOIN [GLOBAL_EDW_MIRROR].[dbo].[EDW_T_D_MST_WORKCTR_CUR_D] AS S
        ON T.[WRK_CNTR_KEY] = S.[WRK_CNTR_KEY];

    -- Step 2: Insert new records from source not existing in target
    INSERT INTO [GLOBAL_EDW].[Propelis].[OPERATION_LEVEL_WORK_CENTER] (
        [WRK_CNTR_KEY],
        [Operation Work Center ID],
        [Operation Work Center Plant ID],
        [Operation Work Center Object ID],
        [Operation Work Center Object Type],
        [Operation Work Center Category],
        [Operation Work Center Location],
        [Operation Work Center Person Responsible],
        [Operation Work Center Standard Value Key],
        [Operation Work Center Usage Code],
        [Operation Work Center Capacity ID],
        [Operation Work Center Supply Area],
        [Operation Work Center Deletion Flag],
        [Operation Work Center Locked Status],
        [ETL_SRC_SYS_CD],
        [ETL_EFFECTV_BEGIN_DATE],
        [ETL_EFFECTV_END_DATE],
        [ETL_CURR_RCD_IND],
        [ETL_CREATED_TS],
        [ETL_UPDTD_TS],
        [Operation Work Center Description],
        [Operation Work Center Category Description],
        [Operation Work Center Person Responsible Name],
        [Operation Work Center Control Key],
        [Operation Work Center Storage Location Storage Resource],
        [Operation Work Center User Name Term],
        [Operation Work Center User Name GRND],
        [Operation Work Center Changed On Date Term],
        [Operation Work Center Changed On Date GRND],
        [Operation Work Center Changed On Date],
        [Operation Work Center Plant Description],
        [Operation Work Center Object Type Description],
        [Operation Work Center Location Description],
        [Operation Work Center Standard Value Description],
        [Operation Work Center Usage Description],
        [Operation Work Center Supply Area Description],
        [Operation Work Center Control Description],
        [Operation Work Center Storage Location Description]
    )
    SELECT
        S.[WRK_CNTR_KEY],
        S.[WRK_CNTR_ID],
        S.[PLNT_ID],
        S.[OBJ_ID],
        S.[OBJ_TYP],
        S.[WRK_CNTR_CTGRY],
        S.[WRK_CNTR_LOC],
        S.[PERSON_RESPNSBLE],
        S.[STD_VAL_KEY],
        S.[USAGE_CD],
        S.[CAPACITY_ID],
        S.[SUPLY_AREA],
        S.[DELETION_FLG],
        S.[LOCKED_STATUS],
        S.[ETL_SRC_SYS_CD],
        S.[ETL_EFFECTV_BEGIN_DATE],
        S.[ETL_EFFECTV_END_DATE],
        S.[ETL_CURR_RCD_IND],
        S.[ETL_CREATED_TS],
        S.[ETL_UPDTD_TS],
        S.[WRK_CNTR_DESC],
        S.[WRK_CNTR_CTGRY_DESC],
        S.[PERSON_RESPNSBLE_NAME],
        S.[CTRL_KEY],
        S.[STOR_LOC_STOR_RESOURCE],
        S.[USR_NAME_TERM],
        S.[USR_NAME_GRND],
        S.[CHANGED_ON_DATE_TERM],
        S.[CHANGED_ON_DATE_GRND],
        S.[CHANGED_ON_DATE],
        S.[PLNT_DESC],
        S.[OBJ_TYP_DESC],
        S.[WRK_CNTR_LOC_DESC],
        S.[STD_VAL_DESC],
        S.[USAGE_DESC],
        S.[SUPLY_AREA_DESC],
        S.[CTRL_DESC],
        S.[STOR_LOC_DESC]
    FROM [GLOBAL_EDW_MIRROR].[dbo].[EDW_T_D_MST_WORKCTR_CUR_D] AS S
    LEFT JOIN [GLOBAL_EDW].[Propelis].[OPERATION_LEVEL_WORK_CENTER] AS T
        ON T.[WRK_CNTR_KEY] = S.[WRK_CNTR_KEY]
    WHERE T.[WRK_CNTR_KEY] IS NULL;
END;