CREATE   PROCEDURE [Propelis].[Proc_SOLD_TO_PARTY]
AS
BEGIN
    ----------------------------------------------------------------------
    -- STEP 1: UPDATE existing records
    ----------------------------------------------------------------------
    UPDATE T
    SET
        T.[Sold To Party ID] = S.[Customer ID],
        T.[Sold To Party Legacy Customer ID] = S.[Legacy Customer ID],
        T.[Sold To Party Name] = S.[Customer Name],
        T.[Sold To Party Customer Line 2 Description] = S.[Customer Line 2 Description],
        T.[Sold To Party Country Code] = S.[Customer Country Code],
        T.[Sold To Party Plant ID] = S.[Customer Plant ID],
        T.[Sold To Party Segment ID] = S.[Customer Segment ID],
        T.[Sold To Party Industry] = S.[Customer Industry],
        T.[Sold To Party Vendor ID] = S.[Customer Vendor ID],
        T.[Sold To Party Group Code] = S.[Customer Group Code],
        T.[Sold To Party Account Group Code] = S.[Customer Account Group Code],
        T.[Sold To Party Title] = S.[Customer Title],
        T.[Sold To Party Search Term] = S.[Customer Search Term],
        T.[Sold To Party Street] = S.[Customer Street],
        T.[Sold To Party City Name] = S.[Customer City],
        T.[Sold To Party Zip Code] = S.[Customer Zip Code],
        T.[Sold To Party Region Code] = S.[Customer Region Code],
        T.[Sold To Party Telephone Number 1 Code] = S.[Customer Telephone Number 1],
        T.[Sold To Party Telephone Number 2 Code] = S.[Customer Telephone Number 2],
        T.[Sold To Party Fax Number Code] = S.[Customer Fax Number Code],
        T.[Sold To Party Tax Number 1 Code] = S.[Customer Tax Number 1 Code],
        T.[Sold To Party Tax Number 2 Code] = S.[Customer Tax Number 2 Code],
        T.[Sold To Party VAT Number Code] = S.[Customer VAT Number Code],
        T.[Sold To Party Credit Limit] = S.[Customer Credit Limit],
        T.[Sold To Party Bonus Rate] = S.[Customer Bonus Rate],
        T.[Sold To Party Express Station] = S.[Customer Express Station],
        T.[Sold To Party Transportation Zone] = S.[Customer Transportation Zone],
        T.[Sold To Party Printer Location Chars] = S.[Customer Printer Location Characteristics],
        T.[Sold To Party Printer Region Chars] = S.[Customer Printer Region Characteristics],
        T.[Sold To Party Printer Site Chars] = S.[Customer Printer Site Characteristics],
        T.[Sold To Party Created Date] = S.[Customer Created Date],
        T.[Sold To Party Created User ID] = S.[Customer Created User ID],
        T.[Sold To Party Updated Date] = S.[Customer Updated Date],
        T.[Sold To Party Updated User ID] = S.[Customer Updated User ID],
        T.[Sold To Party Payment Terms Code] = S.[Customer Payment Terms Code],
        T.[Sold To Party Sales District] = S.[Customer Sales Distribution],
        T.[Sold To Party Order Block For Sales Area] = S.[Customer Order Block For Sales Area],
        T.[Sold To Party Delivery Block For Sales Area] = S.[Customer Delivery Block For Sales Area],
        T.[ETL_SRC_SYS_CD] = S.[ETL_SRC_SYS_CD],
        T.[ETL_EFFECTV_BEGIN_DATE] = S.[ETL_EFFECTV_BEGIN_DATE],
        T.[ETL_EFFECTV_END_DATE] = S.[ETL_EFFECTV_END_DATE],
        T.[ETL_CURR_RCD_IND] = S.[ETL_CURR_RCD_IND],
        T.[ETL_CREATED_TS] = S.[ETL_CREATED_TS],
        T.[ETL_UPDTD_TS] = S.[ETL_UPDTD_TS],
        T.[Sold To Party Corporate Group] = S.[Customer Corporate Group],
        T.[Sold To Party Customer Classification] = S.[Customer Classification],
        T.[Sold To Party Customer Classification Description] = S.[Customer Classification Description],
        T.[Sold To Party Printer Location] = S.[Customer Printer Location],
        T.[Sold To Party Printer Site] = S.[Customer Printer Site],
        T.[Sold To Party Printer Region] = S.[Customer Printer Region],
        T.[Sold To Party Attribute 3] = S.[Customer Attribute 3],
        T.[Sold To Party Attribute 3 Description] = S.[Customer Attribute 3 Description],
        T.[Sold To Party Tax Jurisdiction] = S.[Customer Tax Jurisdiction],
        T.[Sold To Party E-Mail Address] = S.[Customer E-Mail Address],
        T.[Sold To Party Mobile Number] = S.[Customer Mobile Number]
    FROM [GLOBAL_EDW].[Propelis].[SOLD_TO_PARTY] T
    INNER JOIN [GLOBAL_EDW].[dbo].[EDW_T_D_MST_CUSTOMR_CUR_D] S
        ON T.[CUST_KEY] = S.[CUST_KEY];

    ----------------------------------------------------------------------
    -- STEP 2: INSERT new records
    ----------------------------------------------------------------------
    INSERT INTO [GLOBAL_EDW].[Propelis].[SOLD_TO_PARTY] (
        [CUST_KEY],
        [Sold To Party ID],
        [Sold To Party Legacy Customer ID],
        [Sold To Party Name],
        [Sold To Party Customer Line 2 Description],
        [Sold To Party Country Code],
        [Sold To Party Plant ID],
        [Sold To Party Segment ID],
        [Sold To Party Industry],
        [Sold To Party Vendor ID],
        [Sold To Party Group Code],
        [Sold To Party Account Group Code],
        [Sold To Party Title],
        [Sold To Party Search Term],
        [Sold To Party Street],
        [Sold To Party City Name],
        [Sold To Party Zip Code],
        [Sold To Party Region Code],
        [Sold To Party Telephone Number 1 Code],
        [Sold To Party Telephone Number 2 Code],
        [Sold To Party Fax Number Code],
        [Sold To Party Tax Number 1 Code],
        [Sold To Party Tax Number 2 Code],
        [Sold To Party VAT Number Code],
        [Sold To Party Credit Limit],
        [Sold To Party Bonus Rate],
        [Sold To Party Express Station],
        [Sold To Party Transportation Zone],
        [Sold To Party Printer Location Chars],
        [Sold To Party Printer Region Chars],
        [Sold To Party Printer Site Chars],
        [Sold To Party Created Date],
        [Sold To Party Created User ID],
        [Sold To Party Updated Date],
        [Sold To Party Updated User ID],
        [Sold To Party Payment Terms Code],
        [Sold To Party Sales District],
        [Sold To Party Order Block For Sales Area],
        [Sold To Party Delivery Block For Sales Area],
        [ETL_SRC_SYS_CD],
        [ETL_EFFECTV_BEGIN_DATE],
        [ETL_EFFECTV_END_DATE],
        [ETL_CURR_RCD_IND],
        [ETL_CREATED_TS],
        [ETL_UPDTD_TS],
        [Sold To Party Corporate Group],
        [Sold To Party Customer Classification],
        [Sold To Party Customer Classification Description],
        [Sold To Party Printer Location],
        [Sold To Party Printer Site],
        [Sold To Party Printer Region],
        [Sold To Party Attribute 3],
        [Sold To Party Attribute 3 Description],
        [Sold To Party Tax Jurisdiction],
        [Sold To Party E-Mail Address],
        [Sold To Party Mobile Number]
    )
    SELECT
        S.[CUST_KEY],
        S.[Customer ID],
        S.[Legacy Customer ID],
        S.[Customer Name],
        S.[Customer Line 2 Description],
        S.[Customer Country Code],
        S.[Customer Plant ID],
        S.[Customer Segment ID],
        S.[Customer Industry],
        S.[Customer Vendor ID],
        S.[Customer Group Code],
        S.[Customer Account Group Code],
        S.[Customer Title],
        S.[Customer Search Term],
        S.[Customer Street],
        S.[Customer City],
        S.[Customer Zip Code],
        S.[Customer Region Code],
        S.[Customer Telephone Number 1],
        S.[Customer Telephone Number 2],
        S.[Customer Fax Number Code],
        S.[Customer Tax Number 1 Code],
        S.[Customer Tax Number 2 Code],
        S.[Customer VAT Number Code],
        S.[Customer Credit Limit],
        S.[Customer Bonus Rate],
        S.[Customer Express Station],
        S.[Customer Transportation Zone],
        S.[Customer Printer Location Characteristics],
        S.[Customer Printer Region Characteristics],
        S.[Customer Printer Site Characteristics],
        S.[Customer Created Date],
        S.[Customer Created User ID],
        S.[Customer Updated Date],
        S.[Customer Updated User ID],
        S.[Customer Payment Terms Code],
        S.[Customer Sales Distribution],
        S.[Customer Order Block For Sales Area],
        S.[Customer Delivery Block For Sales Area],
        S.[ETL_SRC_SYS_CD],
        S.[ETL_EFFECTV_BEGIN_DATE],
        S.[ETL_EFFECTV_END_DATE],
        S.[ETL_CURR_RCD_IND],
        S.[ETL_CREATED_TS],
        S.[ETL_UPDTD_TS],
        S.[Customer Corporate Group],
        S.[Customer Classification],
        S.[Customer Classification Description],
        S.[Customer Printer Location],
        S.[Customer Printer Site],
        S.[Customer Printer Region],
        S.[Customer Attribute 3],
        S.[Customer Attribute 3 Description],
        S.[Customer Tax Jurisdiction],
        S.[Customer E-Mail Address],
        S.[Customer Mobile Number]
    FROM [GLOBAL_EDW].[dbo].[EDW_T_D_MST_CUSTOMR_CUR_D] S
    LEFT JOIN [GLOBAL_EDW].[Propelis].[SOLD_TO_PARTY] T
        ON T.[CUST_KEY] = S.[CUST_KEY]
    WHERE T.[CUST_KEY] IS NULL;
END